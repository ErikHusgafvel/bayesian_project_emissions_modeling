---
title: \vspace{3in}BDA - Project
author: "Tomi Räsänen - 879626 & Erik Husgafvel - 528867"
bibliography: bibliography.bib
output:
 pdf_document:
   toc: true
   toc_depth: 1
   includes:
     before_body: latex/before_body.tex
   extra_dependencies: ["amsmath"]
---

\newpage


# 1. Introduction

One of the biggest challenges of humankind in the 2020s is figuring out ways to slow down the growth of greenhouse gas emissions and stop global warming (due to human activities) under 2 $^{\circ}$C. The increasing trend of global temperature is easily seen in Figure \ref{fig:global_temp} [cite NASA] in which the global surface temperature is illustrated relative to 1951-1980 average temperatures. Warming can also be seen with one's own eyes by observing the winters that are warming year by year, by noticing that the number of devastating hurricanes is increased, and by finding out the increased rate of ice melting in glaciers during summer.

```{r globaltemp, echo=FALSE, fig.cap="\\label{fig:global_temp}Global Land-Ocean Temperature Index", out.width = '100%'}
knitr::include_graphics("GlobalTemp.png")
```

In response to that warming, many countries have declared a climate emergency to emphasize the criticality of the situation. In addition, young people have organized climate demonstrations around the world, politicians are talking more and more about climate change, and presidents and prime ministers are negotiating agreements and commitments to solve this, one of humanity’s greatest, problem.  But what if, despite attempts of negotiation, the necessary CO$_2$ reduction decisions are not achieved?

In this project, our goal is to model the historical emission trends of selected countries as well as attempts to model their future emissions. We are examining a scenario in which emissions continue to develop at a historical rate, and the necessary reductions are not achieved. In our modeling, the other parameters e.g. population growth and technical conditions, are similar to historical data in our modeling. 


# 2. Data description


Our CO$_2$ data was obtained from \textit{Our World in Data} (OWID) web page [cite OWID_net] and the actual \textit{CSV} file from OWID GitHub page [cite OWID_git]. As mentioned earlier, climate change is a hot topic in the daily news, and there is a lot of studies and research concerning how CO$_2$ emissions are influencing global warming. The data set was also used, for example, when researchers studied the climate impact of the different policy recommendation which targeted to reduce greenhouse gases from the atmosphere.

In our modeling, we are going to select 19 different countries from that OWID data set and examine CO$_2$ data between the years 1950-2018. The countries we have chosen cover the whole globe and are roughly evenly distributed across continents. There are both small and large polluters among the countries.

```{r message=FALSE}
library(rstan)
library(ggplot2)
library(reshape2)
library(gridExtra)
```

```{r}
# Read data to data frame
data_co2 <- read.csv("./data_co2.csv")
data_population <- head(read.csv("./data_population.csv"), -1)

# We discovered that the CO2-emissions difference between our selected countries is so vast
# that it's better to split the data into two different plots.

df_data1 <- data_co2[, (data_co2[dim(data_co2)[1], ]) >= 100]
df_data1 <- df_data1[,order(df_data1[69,])]
df_data1_2 <- data.frame(years=seq(1950,2018), df_data1)
df_plot1 <- melt(data = df_data1_2, id.vars = "years", variable.name = "country")


df_data2 <- data_co2[, (data_co2[dim(data_co2)[1], ]) < 100]
df_data2 <- df_data2[,order(df_data2[69,])]
df_data2_2 <- data.frame(years=seq(1950,2018), df_data2)
df_plot2 <- melt(data = df_data2_2, id.vars = "years", variable.name = "country")

# Population
df_data3 <- data.frame(years=seq(1950,2018), data_population)
df_plot3 <- melt(data = df_data3, id.vars = "years", variable.name = "country")


plot1 <- ggplot(df_plot1, aes(x=years, y=value, colour=country)) +
        geom_line() +
        ggtitle("Selected countries' co2-emissions: \nbig emitters") +
        xlab("Year") +
        ylab("CO2-emission")

plot2 <- ggplot(df_plot2, aes(x=years, y=value, colour=country)) +
        geom_line() +
        ggtitle("Selected countries' co2-emissions: \nsmall emitters") +
        xlab("Year") +
        ylab("CO2-emission")

plot3 <- ggplot(df_plot3, aes(x=years, y=value, colour=country)) +
        geom_line() +
        ggtitle("Selected countries' population development") +
        xlab("Year") +
        ylab("Population")

grid.arrange(
  grobs = list(plot1, plot2, plot3),
  layout_matrix = rbind(c(1, 1, 2, 2, NA),
                        c(1, 1, 2, 2, NA),
                        c(3, 3, 3, 3, 3))
)

```




Example code for hierarchical model from assignment


```{stan output.var=pooledmodel}
data {
  int <lower=0> N; // number of observations
  vector[N] y; // observations
}

parameters {
  real mu;
  real<lower=0> sigma;
}

model {
    mu ~ normal(0, 10); // priors from last week
    sigma ~ inv_chi_square(10); // priors from last week
  
  
  // pooled model likelihood, common mu and sigma for all observations
    y ~ normal(mu, sigma);
}


generated quantities {
  real ypred;
  vector[N] log_lik;
  
  //predictive distribution for any machine
    ypred = normal_rng(mu, sigma);
  
  for (i in 1:N){
      log_lik[i] = normal_lpdf(y[i] | mu, sigma);
  }
}

```



```{r message=FALSE}
# Setting seed to get same "random" results
SEED <- 12345

vectored_data <- data.frame(df_plot2[,'value'])
N <- nrow(vectored_data)

# # Printing out our hierarchical model
# writeLines(readLines("assignment9_hierarchical_model.stan"))


num_of_chains = 4
pool_data <- list(N = N,
                  y = vectored_data[,1])
pool_fit <- rstan::sampling(object = pooledmodel,
                            data = pool_data,
                            iter = 2000,
                            warmup = 1000,
                            #chains = num_of_chains,
                            #verbose = FALSE,
                            #refresh = 0,
                            #show_messages = FALSE,
                            seed = SEED)
```

# References

